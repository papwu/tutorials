<!DOCTYPE html>
<html lang="en-US">
<head>
<title>Using AWS Lambda@Edge with CloudFront</title>
<meta charset="utf-8">
<meta name="description" content="Using AWS Lambda@Edge with CloudFront - Lambda@Edge is an addition to the AWS Lambda compute service which is used to customize the content that cloudfront delivers."/>
<meta name="keywords" content="C, C++, Python, Java, HTML, CSS, JavaScript, SQL, PHP, jQuery, XML, DOM, Bootstrap, Tutorials, Articles, Programming, training, learning, quiz, preferences, examples, code"/>
<link rel="canonical" href="https://www.tutorialspoint.com/aws_lambda/aws_lambda_using_aws_lambdaedge_with_cloudfront.htm" />
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=yes">
<script src="/theme/js/script-min-v2.js?v=3"></script>
<link rel="stylesheet" href="/theme/css/style-min-v2.css?v=6">
<script src="//services.bilsyndication.com/adv1/?d=901" defer="" async=""></script>
<script> var vitag = vitag || {};</script>
<script> vitag.outStreamConfig = { enablePC: false, enableMobile: false };</script>  
<style>
.right-menu .mui-btn {
    background-color:#f68535;
}
a.demo {
    background:#f68535;
}
li.heading {
    background:#f68535;
}
.course-box{background:#f68535}
.home-intro-sub p{color:#f68535}
</style>
</head>
<body>
<header id="header">
<!-- Top sub-menu Starts Here -->
<div class="mui-appbar mui-container-fulid top-menu">
<div class="mui-container">
<div class="top-menu-item home">
<a href="https://www.tutorialspoint.com/index.htm" target="_blank" title="TutorialsPoint - Home"><i class="fal fa-home"></i> <span>Home</span></a>
</div>
<div class="top-menu-item qa">
<a href="https://www.tutorialspoint.com/about/about_careers.htm" target="_blank" title="Job @ Tutorials Point"><i class="fa fa-suitcase"></i> <span>Jobs</span></a>
</div>
<div class="top-menu-item tools">
<a href="https://www.tutorialspoint.com/online_dev_tools.htm" target="_blank" title="Tools - Online Development and Testing Tools"><i class="fal fa-cogs"></i> <span>Tools</span></a>
</div>
<div class="top-menu-item coding-ground">
<a href="https://www.tutorialspoint.com/codingground.htm" target="_blank" title="Coding Ground - Free Online IDE and Terminal"><i class="fal fa-code"></i> <span>Coding Ground </span></a> 
</div>
<div class="top-menu-item current-affairs">
<a href="https://www.tutorialspoint.com/current_affairs.htm" target="_blank" title="Daily Current Affairs"><i class="fal fa-layer-plus"></i> <span>Current Affairs</span></a>
</div>
<div class="top-menu-item upsc-notes">
<a href="https://www.tutorialspoint.com/upsc_ias_exams.htm" target="_blank" title="UPSC IAS Exams Notes - TutorialsPoint"><i class="fal fa-user-tie"></i> <span>UPSC Notes</span></a>
</div>      
<div class="top-menu-item online-tutoris">
<a href="https://www.tutorialspoint.com/tutor_connect/index.php" target="_blank" title="Top Online Tutors - Tutor Connect"><i class="fal fa-user"></i> <span>Online Tutors</span></a>
</div>
<div class="top-menu-item whiteboard">
<a href="https://www.tutorialspoint.com/whiteboard.htm" target="_blank" title="Free Online Whiteboard"><i class="fal fa-chalkboard"></i> <span>Whiteboard</span></a>
</div>
<div class="top-menu-item net-meeting">
<a href="https://www.tutorialspoint.com/netmeeting.php" target="_blank" title="A free tool for online video conferencing"><i class="fal fa-chalkboard-teacher"></i> <span>Net Meeting</span></a> 
</div>
<div class="top-menu-item articles">
<a href="https://www.tutorix.com" target="_blank" title="Tutorx - The Best Learning App" rel="nofollow"><i class="fal fa-video"></i> <span>Tutorix</span></a> 
</div>        
<div class="social-menu-item">
<a href="https://www.facebook.com/tutorialspointindia" target="_blank" rel="nofollow" data-placement="bottom" title="tutorialspoint @ Facebook"><i class="fab fa-facebook-f"></i></a> 
<a href="https://www.twitter.com/tutorialspoint" target="_blank" rel="nofollow" data-placement="bottom" title="tutorialspoint @ Twitter"><i class="fab fa-twitter"></i></a>
<a href="https://www.linkedin.com/company/tutorialspoint" target="_blank" rel="nofollow" data-placement="bottom" title="tutorialspoint @ Linkedin"><i class="fab fa-linkedin-in"></i></a>
<a href="https://www.youtube.com/channel/UCVLbzhxVTiTLiVKeGV7WEBg" target="_blank" rel="nofollow" data-placement="bottom" title="tutorialspoint YouTube"><i class="fab fa-youtube"></i></a>
</div>        
</div>
</div>
<!-- Top sub-menu Ends Here -->
<!-- Top main-menu Starts Here -->
<div class="mui-appbar mui-container-fulid mui--appbar-line-height mui--z1" id="logo-menu">
<div class="mui-container">
<div class="left-menu">
<a href="https://www.tutorialspoint.com/index.htm" title="Tutorialspoint">
<img class="tp-logo" alt="tutorialspoint" src="/aws_lambda/images/logo.png">
</a>
<div class="mui-dropdown">
<a class="mui-btn mui-btn--primary categories" data-mui-toggle="dropdown"><i class="fa fa-th-large"></i> 
<span>Categories <span class="mui-caret"></span></span></a>            
<ul class="mui-dropdown__menu cat-menu">
<li>
<ul>
<li><a href="/academic_tutorials.htm"><i class="fa fa-caret-right"></i> Academic Tutorials</a></li>
<li><a href="/big_data_tutorials.htm"><i class="fa fa-caret-right"></i> Big Data &amp; Analytics </a></li>
<li><a href="/computer_programming_tutorials.htm"><i class="fa fa-caret-right"></i> Computer Programming </a></li>
<li><a href="/computer_science_tutorials.htm"><i class="fa fa-caret-right"></i> Computer Science </a></li>
<li><a href="/database_tutorials.htm"><i class="fa fa-caret-right"></i> Databases </a></li>
<li><a href="/devops_tutorials.htm"><i class="fa fa-caret-right"></i> DevOps </a></li>
<li><a href="/digital_marketing_tutorials.htm"><i class="fa fa-caret-right"></i> Digital Marketing </a></li>
<li><a href="/engineering_tutorials.htm"><i class="fa fa-caret-right"></i> Engineering Tutorials </a></li>
<li><a href="/upsc_ias_exams.htm"><i class="fa fa-caret-right"></i> Exams Syllabus </a></li>
<li><a href="/famous_monuments.htm"><i class="fa fa-caret-right"></i> Famous Monuments </a></li>
<li><a href="/gate_exams_tutorials.htm"><i class="fa fa-caret-right"></i> GATE Exams Tutorials</a></li>
<li><a href="/latest_technologies.htm"><i class="fa fa-caret-right"></i> Latest Technologies </a></li>
<li><a href="/machine_learning_tutorials.htm"><i class="fa fa-caret-right"></i> Machine Learning </a></li>
<li><a href="/mainframe_tutorials.htm"><i class="fa fa-caret-right"></i> Mainframe Development </a></li>
<li><a href="/management_tutorials.htm"><i class="fa fa-caret-right"></i> Management Tutorials </a></li>
<li><a href="/maths_tutorials.htm"><i class="fa fa-caret-right"></i> Mathematics Tutorials</a></li>
<li><a href="/microsoft_technologies_tutorials.htm"><i class="fa fa-caret-right"></i> Microsoft Technologies </a></li>
<li><a href="/misc_tutorials.htm"><i class="fa fa-caret-right"></i> Misc tutorials </a></li>
<li><a href="/mobile_development_tutorials.htm"><i class="fa fa-caret-right"></i> Mobile Development </a></li>
<li><a href="/java_technology_tutorials.htm"><i class="fa fa-caret-right"></i> Java Technologies </a></li>
<li><a href="/python_technologies_tutorials.htm"><i class="fa fa-caret-right"></i> Python Technologies </a></li>
<li><a href="/sap_tutorials.htm"><i class="fa fa-caret-right"></i> SAP Tutorials </a></li>
<li><a href="/scripting_lnaguage_tutorials.htm"><i class="fa fa-caret-right"></i>Programming Scripts </a></li>
<li><a href="/selected_reading.htm"><i class="fa fa-caret-right"></i> Selected Reading </a></li>
<li><a href="/software_quality_tutorials.htm"><i class="fa fa-caret-right"></i> Software Quality </a></li>
<li><a href="/soft_skill_tutorials.htm"><i class="fa fa-caret-right"></i> Soft Skills </a></li>
<li><a href="/telecom_tutorials.htm"><i class="fa fa-caret-right"></i> Telecom Tutorials </a></li>
<li><a href="/upsc_ias_exams.htm"><i class="fa fa-caret-right"></i> UPSC IAS Exams </a></li>
<li><a href="/web_development_tutorials.htm"><i class="fa fa-caret-right"></i> Web Development </a></li>
<li><a href="/sports_tutorials.htm"><i class="fa fa-caret-right"></i> Sports Tutorials </a></li>
<li><a href="/xml_technologies_tutorials.htm"><i class="fa fa-caret-right"></i> XML Technologies </a></li>
<li><a href="/multi_language_tutorials.htm"><i class="fa fa-caret-right"></i> Multi-Language Tutorials</a></li>
<li><a href="/questions_and_answers.htm"><i class="fa fa-caret-right"></i> Interview Questions</a></li>
</ul>
</li>
</ul>
<div class="clear"></div>
</div> 
</div>
<div class="right-menu">
<div class="toc-toggle">
<a href="javascript:void(0);"><i class="fa fa-bars"></i></a>
</div>
<div class="mobile-search-btn">
<a href="https://www.tutorialspoint.com/search.htm"><i class="fal fa-search"></i></a>
</div>
<div class="search-box">
<form method="get" class="" name="searchform" action="https://www.google.com/search" target="_blank" novalidate="">
<input type="hidden" name="sitesearch" value="www.tutorialspoint.com" class="user-valid valid">
<input class="header-search-box" type="text" id="search-string" name="q" placeholder="Search your favorite tutorials..." onfocus="if (this.value == 'Search your favorite tutorials...') {this.value = '';}" onblur="if (this.value == '') {this.value = 'Search your favorite tutorials...';}" autocomplete="off">
<button><i class="fal fa-search"></i></button>
</form>
</div>
<div class="menu-btn library-btn">
<a href="https://www.tutorialspoint.com/tutorialslibrary.htm"><i class="fal fa-cubes"></i> <span>Library</span></a>
</div>
<div class="menu-btn videos-btn">
<a href="https://www.tutorialspoint.com/videotutorials/index.htm"><i class="fal fa-video"></i> <span>Videos</span></a> 
</div>
<div class="menu-btn videos-btn">
<a href="https://www.tutorialspoint.com/questions/index.php"><i class="fa fa-location-arrow"></i> <span>Q/A</span></a>
</div>
<div class="menu-btn ebooks-btn">
<a href="https://store.tutorialspoint.com"><i class="fal fa-book"></i> <span>eBooks</span></a>
</div>
<div class="mui-dropdown">
<button class="mui-btn mui-btn--primary" data-mui-toggle="dropdown">
<span class="mui-caret"></span>
</button>
<ul class="mui-dropdown__menu">
<li><a href="https://www.tutorialspoint.com/tutorialslibrary.htm"><i class="fal fa-cubes"></i> <span>Library</span></a></li>
<li><a href="https://www.tutorialspoint.com/videotutorials/index.htm"><i class="fal fa-video"></i> <span>Videos</span></a></li>
<li><a href="https://store.tutorialspoint.com"><i class="fal fa-book"></i> <span>eBooks</span></a></li>
</ul>
</div>
</div>
</div>
</div>
<!-- Top main-menu Ends Here -->
</header>
<div class="mui-container-fluid content">
<div class="mui-container">
<!-- Tutorial ToC Starts Here -->
<div class="mui-col-md-3 tutorial-toc">
<div class="mini-logo">
<img src="/aws_lambda/images/aws_lambda-mini-logo.jpg" alt="AWS Lambda Tutorial" />
</div>
<ul class="toc chapters">
<li class="heading">AWS Lambda Tutorial</li>
<li><a href="/aws_lambda/index.htm">AWS Lambda - Home</a></li>
<li><a href="/aws_lambda/aws_lambda_overview.htm">AWS Lambda - Overview</a></li>
<li><a href="/aws_lambda/aws_lambda_environment_setup.htm">AWS Lambda - Environment Setup</a></li>
<li><a href="/aws_lambda/aws_lambda_introduction.htm">AWS Lambda - Introduction</a></li>
<li><a href="/aws_lambda/aws_lambda_building_the_lambda_function.htm">Building the Lambda function</a></li>
<li><a href="/aws_lambda/aws_lambda_function_in_nodejs.htm">Function in NODEJS</a></li>
<li><a href="/aws_lambda/aws_lambda_function_in_java.htm">Function in Java</a></li>
<li><a href="/aws_lambda/aws_lambda_function_in_python.htm">Function in Python</a></li>
<li><a href="/aws_lambda/aws_lambda_function_in_go.htm">Function in Go</a></li>
<li><a href="/aws_lambda/aws_lambda_function_in_csharp.htm">Function in C#</a></li>
<li><a href="/aws_lambda/aws_lambda_configuring_lambda_function.htm">Configuring Lambda Function</a></li>
<li><a href="/aws_lambda/aws_lambda_creating_and_deploying_using_aws_console.htm">Creating &amp; Deploying using AWS Console</a></li>
<li><a href="/aws_lambda/aws_lambda_creating_and_deploying_using_aws_cli.htm">Creating &amp; Deploying using AWS CLI</a></li>
<li><a href="/aws_lambda/aws_lambda_creating_and_deploying_using_serverless_framework.htm">Creating &amp; Deploying using Serverless Framework</a></li>
<li><a href="/aws_lambda/aws_lambda_executing_and_invoking_lambda_function.htm">AWS Executing &amp; Invoking Lambda Function</a></li>
<li><a href="/aws_lambda/aws_lambda_deleting_lambda_function.htm">Deleting Lambda Function</a></li>
<li><a href="/aws_lambda/aws_lambda_working_with_amazon_api_gateway.htm">Working with Amazon API Gateway</a></li>
<li><a href="/aws_lambda/aws_lambda_using_lambda_function_with_amazon_s3.htm">Lambda Function with Amazon S3</a></li>
<li><a href="/aws_lambda/aws_lambda_using_lambda_function_with_amazon_dynamodb.htm"> Lambda Function with Amazon DynamoDB</a></li>
<li><a href="/aws_lambda/aws_lambda_using_lambda_function_with_scheduled_events.htm">Lambda Function with Scheduled Events</a></li>
<li><a href="/aws_lambda/aws_lambda_using_lambda_function_with_amazon_sns.htm">Lambda Function with Amazon SNS</a></li>
<li><a href="/aws_lambda/aws_lambda_using_lambda_function_with_cloudtrail.htm">Lambda Function with CloudTrail</a></li>
<li><a href="/aws_lambda/aws_lambda_using_lambda_function_with_amazon_kinesis.htm"> Lambda Function with Amazon Kinesis</a></li>
<li><a href="/aws_lambda/aws_lambda_using_lambda_function_with_custom_user_applications.htm">Lambda Function with Custom User Applications</a></li>
<li><a href="/aws_lambda/aws_lambda_using_aws_lambdaedge_with_cloudfront.htm">AWS Lambda@Edge with CloudFront</a></li>
<li><a href="/aws_lambda/aws_lambda_monitoring_and_troubleshooting_using_cloudwatch.htm">Monitoring and TroubleShooting using Cloudwatch</a></li>
<li><a href="/aws_lambda/aws_lambda_additional_example.htm">AWS Lambda - Additional Example</a></li>
<ul class="toc chapters">
<li class="heading">AWS Lambda Useful resources</li>
<li><a href="/aws_lambda/aws_lambda_quick_guide.htm">AWS Lambda - Quick Guide</a></li>
<li><a href="/aws_lambda/aws_lambda_useful_resources.htm">AWS Lambda - Useful resources</a></li>
<li><a href="/aws_lambda/aws_lambda_discussion.htm">AWS Lambda - Discussion</a></li>
</ul>
<ul class="toc reading">
<li class="sreading">Selected Reading</li>
<li><a target="_top" href="/upsc_ias_exams.htm">UPSC IAS Exams Notes</a></li>
<li><a target="_top" href="/developers_best_practices/index.htm">Developer's Best Practices</a></li>
<li><a target="_top" href="/questions_and_answers.htm">Questions and Answers</a></li>
<li><a target="_top" href="/effective_resume_writing.htm">Effective Resume Writing</a></li>
<li><a target="_top" href="/hr_interview_questions/index.htm">HR Interview Questions</a></li>
<li><a target="_top" href="/computer_glossary.htm">Computer Glossary</a></li>
<li><a target="_top" href="/computer_whoiswho.htm">Who is Who</a></li>
</ul>
</div>
<!-- Tutorial ToC Ends Here -->
<!-- Tutorial Content Starts Here -->
<div class="mui-col-md-6 tutorial-content">
<h1>Using AWS Lambda@Edge with CloudFront</h1>
<hr />
<div class="top-ad-heading">Advertisements</div>
<div style="text-align: center;">
<script><!--
google_ad_client = "pub-7133395778201029";
var width = document.getElementsByClassName("tutorial-content")[0].clientWidth - 40;
google_ad_width = width;
google_ad_height = 150;
google_ad_format = width + "x150_as";
google_ad_type = "image";
google_ad_channel = "";
//--></script>
<script src="https://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</div>
<div class="mui-container-fluid button-borders">
<div class="pre-btn">
<a href="/aws_lambda/aws_lambda_using_lambda_function_with_custom_user_applications.htm"><i class="fal fa-chevron-circle-left"></i> Previous Page</a>
</div>
<div class="nxt-btn">
<a href="/aws_lambda/aws_lambda_monitoring_and_troubleshooting_using_cloudwatch.htm">Next Page <i class="fal fa-chevron-circle-right"></i>&nbsp;</a>
</div>
</div>
<div class="clearer"></div>
<p>Lambda@Edge is an addition to the AWS Lambda compute service which is used to customize the content that cloudfront delivers.</p>
<p>The block diagram which shows the working of AWS Lambda with cloudfront from AWS is shown below &minus;</p>
<img src="/aws_lambda/images/block_diagram_cloudfront.jpg" alt="Block Diagram Cloudfront" />
<p>There are four ways in which AWS Lambda can be used &minus;</p>
<ul class="list">
<li><p><b>Viewer Request &minus;</b> End user makes the request called Viewer Request to CloudFront</p></li>
<li><p><b>Origin Request &minus;</b> CloudFront forwards the request to the origin</p></li>
<li><p><b>Origin Response &minus;</b> CloudFront receives the response from the origin</p></li>	
<li><p><b>Viewer Response &minus;</b> CloudFront send the response to the viewer</p></li>
</ul>
<p>We can use Lambda@Edge for the following purposes &minus;</p>
<ul class="list">
<li><p>To change the headers at the request and response time.</p></li>
<li><p>Add cookies details to the headers. Carry out AB testing based on the request and response.</p></li>
<li><p>Redirect the URL to another site, based on the header details.</p></li>
<li><p>We can fetch the user-agent from the headers and find out the details of the browser, OS, etc.</p></li>
</ul>
<h2>Requisites</h2>
<p>To start with working on CloudFront and Lambda@Edge, we need the following &minus;</p>
<ul class="list">
<li><p>Create S3 storage bucket with file details</p></li>
<li><p>Create role which will allow permission to work with CloudFront and Lambda@Edge</p></li>
<li><p>Create CloudFront distribution</p></li>
<li><p>Create lambda function</p></li>
<li><p>Add lambda function details to cloudfront</p></li>
<li><p>Check the cloudfront url in browser</p></li>
</ul>
<p>We will work on an example with CloudFront and Lambda@Egde, wherein we will host the page and change the response when detected as desktop and devices.</p>
<h2>Create S3 Storage Bucket with File Details</h2>
<p>Login to AWS console and create a bucket in S3 and add the <b>. html</b> file which you want to display.</p>
<img src="/aws_lambda/images/storage_bucket.jpg" alt="Storage Bucket" />
<p>Click on <b>S3</b> and <b>Create bucket</b> as shown below &minus;</p>
<img src="/aws_lambda/images/amazon_s3.jpg" alt="Amazon S3" />
<p>Now, click <b>Create bucket</b> button and add the details of the bucket as shown below &minus;</p>
<img src="/aws_lambda/images/create_bucket_button.jpg" alt="Create Bucket Button" />
<p>Click on <b>Create</b> button and upload the .html in it.</p>
<img src="/aws_lambda/images/upload_html.jpg" alt="Upload Html" />
<h2>Create Role</h2>
<p>Go to AWS console and click <b>IAM</b>.</p>
<img src="/aws_lambda/images/security.jpg" alt="Security" />
<p>Now, click <b>Roles -&gt; Create role</b> button as shown &minus;</p>
<img src="/aws_lambda/images/create_role_dashboard.jpg" alt="Create Role Dashboard" />
<p>Choose the permission for <b>S3, Lambda</b> and <b>Cloudfront</b>. It is a good practice to create the policy giving permission to only the required function, storage by using the ARN details.</p>
<p>In the example discussed below, we are showing the <b>Full Access</b> permission. Policies for the role name <b>role for cloudfront</b> is added as shown above. Click on Create role.</p>
<img src="/aws_lambda/images/full_access_permission.jpg" alt="Full Access Permission" />
<p></p>
<img src="/aws_lambda/images/role_cloudfront.jpg" alt="Role Cloudfront" />
<p>All the policy required for lambda@edge and cloudfront are as shown above. There is a additional step to be done here since incase of cloudfront the url will be available across region and it needs a trust relationship between the services we are using.</p>
<p>Now, for the role created, click on <b>Trust relationships</b> tab as shown &minus;</p>
<img src="/aws_lambda/images/relationship.jpg" alt="Relationship" />
<p>Click on <b>Edit Trust Relationship</b> as shown below &minus;</p>
<img src="/aws_lambda/images/edit_trust_relationship.jpg" alt="Edit Trust Relationship" />
<p>It displays a policy document. We need to add the other services in the <b>Principal -&gt; Service</b> which we are planning to use. The final trust relationship policy document is as shown below &minus;</p>
<img src="/aws_lambda/images/final_trust_relationship.jpg" alt="Final Trust Relationship" />
<p>Click <b>Update Trust Policy</b> button to save the changes.</p>
<h2>Create CloudFront Distribution</h2>
<p>Go to CloudFront service as shown below &minus;</p>
<img src="/aws_lambda/images/create_cloudfront.jpg" alt="Create Cloudfront" />
<p>Click on CloudFront service and click on <b>Create Distribution</b> &minus;</p>
<img src="/aws_lambda/images/create_distribution.jpg" alt="Create Distribution" />
<h3>Origin Settings, Behaviour Settings and Distribution settings</h3>
<p>Let us look into these settings one by one &minus;</p>
<p><b>Origin Settings</b></p>
<img src="/aws_lambda/images/origin_settings.jpg" alt="Origin Settings" />
<p>Various parameters of Origin settings are explained as below &minus;</p>
<p><b>Origin Domain Name &minus;</b> This is the name of the S3 bucket where we have stored the html files. We can also store images, if any, in the S3 bucket by creating folders of our choice.</p>
<p><b>Origin Path &minus;</b> Here you need to enter the name of the folder where the files are stored. At present, we do not have this folder, so we will keep it blank for now.</p>
<p><b>Origin ID &minus;</b> It gets populated when the origin domain name is selected. You can change the id as per your choice.</p>
<p><b>Restrict Bucket Access &minus;</b> In this, we will choose the option <b>yes</b>. Here we need security for the S3 bucket so that no one has the access to the S3 bucket. For this option there are some more options populated like <b>Origin Access Identity, Comment and Grant Read Permission on Bucket</b>.</p>
<p><b>Origin Access Identity &minus;</b> We have used create a new identity option. You can also choose the existing identity. This creates a new identity which is used by CloudFront to read the details from S3 bucket.</p>
<p><b>Grand Read Permission on Bucket &minus;</b> For this, choose the option <b>Yes</b>.</p>
<p><b>Origin Custom Headers &minus;</b> We will keep the headers blank here, as we do not need the details right now.</p>
<p>Next, let us discuss and fill up the <b>Behaviour Settings</b> for Cloudront distribution &minus;</p>
<img src="/aws_lambda/images/behaviour_settings.jpg" alt="Behaviour Settings" />
<p>Now, select the protocol – https or http, and the caching option. Note that the default caching is 86400 or 24 hrs. You can change this value as per the requirement.</p>
<p>Click <b>Object Caching</b> (customize option) to change the caching. You can use <b>smooth streaming</b> in case if there any videos on your page. Here, we are keeping the default option available. Once the lambda function is created, its details will be added.</p>
<p>The details for distribution settings are shown below &minus;</p>
<img src="/aws_lambda/images/obeject_caching.jpg" alt="Object Caching " />
<p>Various parameters of distribution settings are explained below &minus;</p>
<p><b>Price class &minus;</b> It has details like the origin of users traffic. Note that here we have selected the default one - <b>Use All Edge Locations.</b></p>
<p><b>AWS WAF Web ACL &minus;</b> This is for web application firewall selection. Here, it has option as <b>None</b>. First, we need to create the firewall in AWS. It provides security to the site.</p>
<p><b>Alternate Domain Names &minus;</b> Here you can specify the domain name if you have.</p>
<p><b>SSL Certificate &minus;</b> This has all the details to be selected for SSL certificate. We will keep the default ones.</p>
<p><b>Default Root Object &minus;</b> Here we will specify the filename which we have uploaded in S3. For this, we need the content from the .html to be displayed by default.</p>
<p>For the rest, we will keep the default setting.</p>
<p>Click <b>Create Distribution</b> button to add the distribution.</p>
<img src="/aws_lambda/images/cloudfront_distribution.jpg" alt="Cloudfront Distribution" />
<p>Note that the distribution will take some time to show the status as deployed.</p>
<h2>Create AWS Lambda Function</h2>
<p>Go to AWS console and create Lambda function.</p>
<img src="/aws_lambda/images/cloudfront_function.jpg" alt="Cloudfront Function" />
<p>In AWS Lambda code, we will take the request headers and check the user-agent. If the user-agent is from desktop, we will change the response to display message as <b>“DESKTOP : Welcome to AWS Lambda with Cloudfront!”</b> and if device the message will be<b>“MOBILE DEVICES : Hello from Lambda@Edge!”</b></p>
<p>The corresponding AWS Lambda code is as shown below &minus;</p>
<pre class="prettyprint notranslate">
let content = `
&lt;\!DOCTYPE html&gt;
&lt;html lang="en"&gt;
   &lt;head&gt;
      &lt;meta charset="utf-8"&gt;
      &lt;title&gt;Simple Lambda@Edge Static Content Response&lt;/title&gt;
      &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
   &lt;/head&gt;
   
   &lt;body&gt;
      &lt;h1&gt;MOBILE DEVICES : Hello from Lambda@Edge!&lt;/h1&gt;
   &lt;/body&gt;
&lt;/html&gt;
`;
let content1 = `
&lt;\!DOCTYPE html&gt;
&lt;html lang="en"&gt;
   &lt;head&gt;
      &lt;meta charset="utf-8"&gt;
      &lt;title&gt;Simple Lambda@Edge Static Content Response&lt;/title&gt;
      &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
   &lt;/head&gt;
   
   &lt;body&gt;
      &lt;h1&gt;DESKTOP : Welcome to AWS Lambda with Cloudfront!&lt;/h1&gt;
   &lt;/body&gt;
&lt;/html&gt;
`;
exports.handler = (event, context, callback) =&gt; {
   let request = event.Records[0].cf.request;
   let finalrequest = JSON.stringify(request);
   let headers = request.headers;
   let useragent = JSON.stringify(headers["user-agent"][0].value);
   let str = "";
   if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|Mobile|mobile|CriOS/i.test(useragent)) {
      str = content;
   } else {
      str = content1;
   }
   const response = {
      status: '200',
      statusDescription: 'OK',        
      body: str+useragent,
   };
   callback(null, response);
};
</pre>
<p>Now, save the Lambda function. Note that we need to publish the Lambda function so that it can be used with all regions. To publish, we need to do the following &minus;</p>
<p>From Actions dropdown, select <b>Publish new version</b> as shown below &minus;</p>
<img src="/aws_lambda/images/publish_new_version.jpg" alt="Publish New Version" />
<p>If you, click <b>Publish new version</b>, it displays the following screen &minus;</p>
<img src="/aws_lambda/images/publish_latest_version.jpg" alt="Publish Latest Version" />
<p>Now, enter the Version description and click <b>Publish</b>. The ARN will display the version of the AWS Lambda function created as shown below &minus;</p>
<img src="/aws_lambda/images/version_description.jpg" alt="Version Description" />
<p>Add CloudFront trigger to the new version created as shown below &minus;</p>
<img src="/aws_lambda/images/cloudfront_trigger.jpg" alt="Cloudfront Trigger" />
<p>Now, add the configuration details for CloudFront. The CloudFront event has option for <b>Viewer request, Origin request, Origin response</b>, and <b>Viewer response</b>.</p>
<p>Next, choose the CloudFront distribution created earlier. From <b>events</b>, we will select <b>Viewer request</b>. Based on the viewer request, the desktop/device from user-agent will be decided and the response will be changed. Next, add the trigger details.</p>
<img src="/aws_lambda/images/viewer_request.jpg" alt="Viewer Request" />
<p>Once the trigger is added, we need to wait for the distribution from CloudFront to be deployed.</p>
<img src="/aws_lambda/images/cloudfront_deploy.jpg" alt="Cloudfront Deploy" />
<p>Once the status is changed to <b>Deployed</b>, we can test the CloudFront url and check the domain name in browser.</p>
<p>The display in desktop browser is as shown below. Here we have printed the user-agent from the viewer-request event.</p>
<img src="/aws_lambda/images/desktop_browser.jpg" alt="Desktop Browser" />
<p>This is the display in mobile device.</p>
<img src="/aws_lambda/images/mobile_device.jpg" alt="Mobile Device" />
<p>Thus, in the above example, we have used Lambda@Edge to change response on desktop and mobile device.</p>
<div class="mui-container-fluid button-borders show">
<div class="pre-btn">
<a href="/aws_lambda/aws_lambda_using_lambda_function_with_custom_user_applications.htm"><i class="fal fa-chevron-circle-left"></i> Previous Page</a>
</div>
<div class="nxt-btn">
<a href="/aws_lambda/aws_lambda_monitoring_and_troubleshooting_using_cloudwatch.htm">Next Page <i class="fal fa-chevron-circle-right"></i>&nbsp;</a>
</div>
</div>
<div class="google-bottom-ads">
<div>Advertisements</div>
<script><!--
var width = 580;
var height = 400;
var format = "580x400_as";
if( window.innerWidth < 468 ){
   width = 300;
   height = 250;
   format = "300x250_as";
}
google_ad_client = "pub-7133395778201029";
google_ad_width = width;
google_ad_height = height;
google_ad_format = format;
google_ad_type = "image";
google_ad_channel ="";
//--></script>
<script src="https://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
<div class="space-bottom"></div>
</div>
</div>
<!-- Tutorial Content Ends Here -->
<!-- Right Column Starts Here -->
<div class="mui-col-md-2 google-right-ads">
<div class="space-top"></div>
<div class="google-right-ad" style="margin: 0px auto !important;margin-top:5px;">
<script><!--
google_ad_client = "pub-2537027957187252";
google_ad_width = 300;
google_ad_height = 250;
google_ad_format = "300x250_as";
google_ad_type = "image";
google_ad_channel ="";
//--></script>
<script src="https://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</div>
<div class="google-right-ad">
<div class="adsbyvli" data-ad-slot="vi_9012177"></div>
<script>(vitag.Init = window.vitag.Init || []).push(function(){viAPItag.display("vi_9012177")})</script>
</div>
<div class="space-bottom"></div>
<div class="google-right-ad">
<div class="adsbyvli" data-ad-slot="vi_9013289"></div>
<script>(vitag.Init = window.vitag.Init || []).push(function(){viAPItag.display("vi_9013289")})</script>
</div>
<div class="space-bottom" style="margin-bottom:15px;"></div>
</div>
<!-- Right Column Ends Here -->
</div>
</div>
<div class="clear"></div>
<footer id="footer">
<div class="mui--text-center">
<div class="mui--text-caption mui--text-light">
<a href="/index.htm" class="logo"><img class="img-responsive" src="/images/logo-black.png" alt="Tutorials Point" title="Tutorials Point"></a>
</div>
<ul class="mui-list--inline mui--text-body2 mui--text-light">
<li><a href="/about/index.htm"><i class="fal fa-globe"></i> About us</a></li>
<li><a href="/about/about_terms_of_use.htm"><i class="fal fa-asterisk"></i> Terms of use</a></li>
<li><a href="/about/about_privacy.htm#cookies"> <i class="fal fa-shield-check"></i> Cookies Policy</a></li>
<li><a href="/about/faq.htm"><i class="fal fa-question-circle"></i> FAQ's</a></li>
<li><a href="/about/about_helping.htm"><i class="fal fa-hands-helping"></i> Helping</a></li>
<li><a href="/about/contact_us.htm"><i class="fal fa-map-marker-alt"></i> Contact</a></li>
</ul>
<div class="mui--text-caption mui--text-light bottom-copyright-text">&copy; Copyright 2019. All Rights Reserved.</div>
</div>
<div id="privacy-banner">
  <div>
    <p>
      We use cookies to provide and improve our services. By using our site, you consent to our Cookies Policy.
      <a id="banner-accept" href="#">Accept</a>
      <a id="banner-learn" href="/about/about_cookies.htm" target="_blank">Learn more</a>
    </p>
  </div>
</div>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-232293-17"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-232293-6');
</script>
</footer>
</body>
</html>
