<!DOCTYPE html>
<html lang="en-US">
<head>
<title>Microsoft Dynamics CRM - Plugins - Tutorialspoint</title>
<meta charset="utf-8">
<meta name="description" content="Microsoft Dynamics CRM - Plugins - A plug-in is a custom business logic that integrates with Microsoft Dynamics CRM to modify or extend the standard behavior of the platform. Plug-ins act as even"/>
<meta name="keywords" content="C, C++, Python, Java, HTML, CSS, JavaScript, SQL, PHP, jQuery, XML, DOM, Bootstrap, Tutorials, Articles, Programming, training, learning, quiz, preferences, examples, code"/>
<link rel="canonical" href="https://www.tutorialspoint.com/microsoft_crm/microsoft_crm_plugins.htm" />
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=yes">
<script src="/theme/js/script-min-v2.js?v=3"></script>
<link rel="stylesheet" href="/theme/css/style-min-v2.css?v=6">
<script src="//services.bilsyndication.com/adv1/?d=901" defer="" async=""></script>
<script> var vitag = vitag || {};</script>
<script> vitag.outStreamConfig = { enablePC: false, enableMobile: false };</script>  
<style>
.right-menu .mui-btn {
    background-color:#036db0;
}
a.demo {
    background:#036db0;
}
li.heading {
    background:#036db0;
}
.course-box{background:#036db0}
.home-intro-sub p{color:#036db0}
</style>
</head>
<body>
<header id="header">
<!-- Top sub-menu Starts Here -->
<div class="mui-appbar mui-container-fulid top-menu">
<div class="mui-container">
<div class="top-menu-item home">
<a href="https://www.tutorialspoint.com/index.htm" target="_blank" title="TutorialsPoint - Home"><i class="fal fa-home"></i> <span>Home</span></a>
</div>
<div class="top-menu-item qa">
<a href="https://www.tutorialspoint.com/about/about_careers.htm" target="_blank" title="Job @ Tutorials Point"><i class="fa fa-suitcase"></i> <span>Jobs</span></a>
</div>
<div class="top-menu-item tools">
<a href="https://www.tutorialspoint.com/online_dev_tools.htm" target="_blank" title="Tools - Online Development and Testing Tools"><i class="fal fa-cogs"></i> <span>Tools</span></a>
</div>
<div class="top-menu-item coding-ground">
<a href="https://www.tutorialspoint.com/codingground.htm" target="_blank" title="Coding Ground - Free Online IDE and Terminal"><i class="fal fa-code"></i> <span>Coding Ground </span></a> 
</div>
<div class="top-menu-item current-affairs">
<a href="https://www.tutorialspoint.com/current_affairs.htm" target="_blank" title="Daily Current Affairs"><i class="fal fa-layer-plus"></i> <span>Current Affairs</span></a>
</div>
<div class="top-menu-item upsc-notes">
<a href="https://www.tutorialspoint.com/upsc_ias_exams.htm" target="_blank" title="UPSC IAS Exams Notes - TutorialsPoint"><i class="fal fa-user-tie"></i> <span>UPSC Notes</span></a>
</div>      
<div class="top-menu-item online-tutoris">
<a href="https://www.tutorialspoint.com/tutor_connect/index.php" target="_blank" title="Top Online Tutors - Tutor Connect"><i class="fal fa-user"></i> <span>Online Tutors</span></a>
</div>
<div class="top-menu-item whiteboard">
<a href="https://www.tutorialspoint.com/whiteboard.htm" target="_blank" title="Free Online Whiteboard"><i class="fal fa-chalkboard"></i> <span>Whiteboard</span></a>
</div>
<div class="top-menu-item net-meeting">
<a href="https://www.tutorialspoint.com/netmeeting.php" target="_blank" title="A free tool for online video conferencing"><i class="fal fa-chalkboard-teacher"></i> <span>Net Meeting</span></a> 
</div>
<div class="top-menu-item articles">
<a href="https://www.tutorix.com" target="_blank" title="Tutorx - The Best Learning App" rel="nofollow"><i class="fal fa-video"></i> <span>Tutorix</span></a> 
</div>        
<div class="social-menu-item">
<a href="https://www.facebook.com/tutorialspointindia" target="_blank" rel="nofollow" data-placement="bottom" title="tutorialspoint @ Facebook"><i class="fab fa-facebook-f"></i></a> 
<a href="https://www.twitter.com/tutorialspoint" target="_blank" rel="nofollow" data-placement="bottom" title="tutorialspoint @ Twitter"><i class="fab fa-twitter"></i></a>
<a href="https://www.linkedin.com/company/tutorialspoint" target="_blank" rel="nofollow" data-placement="bottom" title="tutorialspoint @ Linkedin"><i class="fab fa-linkedin-in"></i></a>
<a href="https://www.youtube.com/channel/UCVLbzhxVTiTLiVKeGV7WEBg" target="_blank" rel="nofollow" data-placement="bottom" title="tutorialspoint YouTube"><i class="fab fa-youtube"></i></a>
</div>        
</div>
</div>
<!-- Top sub-menu Ends Here -->
<!-- Top main-menu Starts Here -->
<div class="mui-appbar mui-container-fulid mui--appbar-line-height mui--z1" id="logo-menu">
<div class="mui-container">
<div class="left-menu">
<a href="https://www.tutorialspoint.com/index.htm" title="Tutorialspoint">
<img class="tp-logo" alt="tutorialspoint" src="/microsoft_crm/images/logo.png">
</a>
<div class="mui-dropdown">
<a class="mui-btn mui-btn--primary categories" data-mui-toggle="dropdown"><i class="fa fa-th-large"></i> 
<span>Categories <span class="mui-caret"></span></span></a>            
<ul class="mui-dropdown__menu cat-menu">
<li>
<ul>
<li><a href="/academic_tutorials.htm"><i class="fa fa-caret-right"></i> Academic Tutorials</a></li>
<li><a href="/big_data_tutorials.htm"><i class="fa fa-caret-right"></i> Big Data &amp; Analytics </a></li>
<li><a href="/computer_programming_tutorials.htm"><i class="fa fa-caret-right"></i> Computer Programming </a></li>
<li><a href="/computer_science_tutorials.htm"><i class="fa fa-caret-right"></i> Computer Science </a></li>
<li><a href="/database_tutorials.htm"><i class="fa fa-caret-right"></i> Databases </a></li>
<li><a href="/devops_tutorials.htm"><i class="fa fa-caret-right"></i> DevOps </a></li>
<li><a href="/digital_marketing_tutorials.htm"><i class="fa fa-caret-right"></i> Digital Marketing </a></li>
<li><a href="/engineering_tutorials.htm"><i class="fa fa-caret-right"></i> Engineering Tutorials </a></li>
<li><a href="/upsc_ias_exams.htm"><i class="fa fa-caret-right"></i> Exams Syllabus </a></li>
<li><a href="/famous_monuments.htm"><i class="fa fa-caret-right"></i> Famous Monuments </a></li>
<li><a href="/gate_exams_tutorials.htm"><i class="fa fa-caret-right"></i> GATE Exams Tutorials</a></li>
<li><a href="/latest_technologies.htm"><i class="fa fa-caret-right"></i> Latest Technologies </a></li>
<li><a href="/machine_learning_tutorials.htm"><i class="fa fa-caret-right"></i> Machine Learning </a></li>
<li><a href="/mainframe_tutorials.htm"><i class="fa fa-caret-right"></i> Mainframe Development </a></li>
<li><a href="/management_tutorials.htm"><i class="fa fa-caret-right"></i> Management Tutorials </a></li>
<li><a href="/maths_tutorials.htm"><i class="fa fa-caret-right"></i> Mathematics Tutorials</a></li>
<li><a href="/microsoft_technologies_tutorials.htm"><i class="fa fa-caret-right"></i> Microsoft Technologies </a></li>
<li><a href="/misc_tutorials.htm"><i class="fa fa-caret-right"></i> Misc tutorials </a></li>
<li><a href="/mobile_development_tutorials.htm"><i class="fa fa-caret-right"></i> Mobile Development </a></li>
<li><a href="/java_technology_tutorials.htm"><i class="fa fa-caret-right"></i> Java Technologies </a></li>
<li><a href="/python_technologies_tutorials.htm"><i class="fa fa-caret-right"></i> Python Technologies </a></li>
<li><a href="/sap_tutorials.htm"><i class="fa fa-caret-right"></i> SAP Tutorials </a></li>
<li><a href="/scripting_lnaguage_tutorials.htm"><i class="fa fa-caret-right"></i>Programming Scripts </a></li>
<li><a href="/selected_reading.htm"><i class="fa fa-caret-right"></i> Selected Reading </a></li>
<li><a href="/software_quality_tutorials.htm"><i class="fa fa-caret-right"></i> Software Quality </a></li>
<li><a href="/soft_skill_tutorials.htm"><i class="fa fa-caret-right"></i> Soft Skills </a></li>
<li><a href="/telecom_tutorials.htm"><i class="fa fa-caret-right"></i> Telecom Tutorials </a></li>
<li><a href="/upsc_ias_exams.htm"><i class="fa fa-caret-right"></i> UPSC IAS Exams </a></li>
<li><a href="/web_development_tutorials.htm"><i class="fa fa-caret-right"></i> Web Development </a></li>
<li><a href="/sports_tutorials.htm"><i class="fa fa-caret-right"></i> Sports Tutorials </a></li>
<li><a href="/xml_technologies_tutorials.htm"><i class="fa fa-caret-right"></i> XML Technologies </a></li>
<li><a href="/multi_language_tutorials.htm"><i class="fa fa-caret-right"></i> Multi-Language Tutorials</a></li>
<li><a href="/questions_and_answers.htm"><i class="fa fa-caret-right"></i> Interview Questions</a></li>
</ul>
</li>
</ul>
<div class="clear"></div>
</div> 
</div>
<div class="right-menu">
<div class="toc-toggle">
<a href="javascript:void(0);"><i class="fa fa-bars"></i></a>
</div>
<div class="mobile-search-btn">
<a href="https://www.tutorialspoint.com/search.htm"><i class="fal fa-search"></i></a>
</div>
<div class="search-box">
<form method="get" class="" name="searchform" action="https://www.google.com/search" target="_blank" novalidate="">
<input type="hidden" name="sitesearch" value="www.tutorialspoint.com" class="user-valid valid">
<input class="header-search-box" type="text" id="search-string" name="q" placeholder="Search your favorite tutorials..." onfocus="if (this.value == 'Search your favorite tutorials...') {this.value = '';}" onblur="if (this.value == '') {this.value = 'Search your favorite tutorials...';}" autocomplete="off">
<button><i class="fal fa-search"></i></button>
</form>
</div>
<div class="menu-btn library-btn">
<a href="https://www.tutorialspoint.com/tutorialslibrary.htm"><i class="fal fa-cubes"></i> <span>Library</span></a>
</div>
<div class="menu-btn videos-btn">
<a href="https://www.tutorialspoint.com/videotutorials/index.htm"><i class="fal fa-video"></i> <span>Videos</span></a> 
</div>
<div class="menu-btn videos-btn">
<a href="https://www.tutorialspoint.com/questions/index.php"><i class="fa fa-location-arrow"></i> <span>Q/A</span></a>
</div>
<div class="menu-btn ebooks-btn">
<a href="https://store.tutorialspoint.com"><i class="fal fa-book"></i> <span>eBooks</span></a>
</div>
<div class="mui-dropdown">
<button class="mui-btn mui-btn--primary" data-mui-toggle="dropdown">
<span class="mui-caret"></span>
</button>
<ul class="mui-dropdown__menu">
<li><a href="https://www.tutorialspoint.com/tutorialslibrary.htm"><i class="fal fa-cubes"></i> <span>Library</span></a></li>
<li><a href="https://www.tutorialspoint.com/videotutorials/index.htm"><i class="fal fa-video"></i> <span>Videos</span></a></li>
<li><a href="https://store.tutorialspoint.com"><i class="fal fa-book"></i> <span>eBooks</span></a></li>
</ul>
</div>
</div>
</div>
</div>
<!-- Top main-menu Ends Here -->
</header>
<div class="mui-container-fluid content">
<div class="mui-container">
<!-- Tutorial ToC Starts Here -->
<div class="mui-col-md-3 tutorial-toc">
<div class="mini-logo">
<img src="/microsoft_crm/images/microsoft-crm-mini-logo.jpg" alt="Microsoft CRM Tutorial" />
</div>
<ul class="toc chapters">
<li class="heading">Microsoft Dynamics CRM Tutorial</li>
<li><a href="/microsoft_crm/index.htm">Microsoft CRM - Home</a></li>
<li><a href="/microsoft_crm/microsoft_crm_overview.htm">Microsoft CRM - Overview</a></li>
<li><a href="/microsoft_crm/microsoft_crm_environment.htm">Microsoft CRM - Environment</a></li>
<li><a href="/microsoft_crm/microsoft_crm_functional_modules.htm">Microsoft CRM - Functional Modules</a></li>
<li><a href="/microsoft_crm/microsoft_crm_entities_and_records.htm">Microsoft CRM - Entities &amp; Records</a></li>
<li><a href="/microsoft_crm/microsoft_crm_fields.htm">Microsoft CRM - Fields</a></li>
<li><a href="/microsoft_crm/microsoft_crm_forms.htm">Microsoft CRM - Forms</a></li>
<li><a href="/microsoft_crm/microsoft_crm_searching.htm">Microsoft CRM - Searching</a></li>
<li><a href="/microsoft_crm/microsoft_crm_web_resources.htm">Microsoft CRM - Web Resources</a></li>
<li><a href="/microsoft_crm/microsoft_crm_jscript_web_resources.htm">JScript Web Resources</a></li>
<li><a href="/microsoft_crm/microsoft_crm_html_web_resources.htm">HTML Web Resources</a></li>
<li><a href="/microsoft_crm/microsoft_crm_workflow_processes.htm">Microsoft CRM - Workflow Processes</a></li>
<li><a href="/microsoft_crm/microsoft_crm_plugins.htm">Microsoft CRM - Plugins</a></li>
<li><a href="/microsoft_crm/microsoft_crm_plugin_registration.htm">Microsoft CRM - Plugin Registration</a></li>
<li><a href="/microsoft_crm/microsoft_crm_web_services.htm">Microsoft CRM - Web Services</a></li>
<li><a href="/microsoft_crm/microsoft_crm_solutions.htm">Microsoft CRM - Solutions</a></li>
</ul>
<ul class="toc chapters">
<li class="heading">Microsoft CRM Useful Resources</li>
<li><a href="/microsoft_crm/microsoft_crm_quick_guide.htm">Microsoft CRM - Quick Guide</a></li>
<li><a href="/microsoft_crm/microsoft_crm_useful_resources.htm">Microsoft CRM - Useful Resources</a></li>
<li><a href="/microsoft_crm/microsoft_crm_discussion.htm">Microsoft CRM - Discussion</a></li>
</ul>
<ul class="toc reading">
<li class="sreading">Selected Reading</li>
<li><a target="_top" href="/upsc_ias_exams.htm">UPSC IAS Exams Notes</a></li>
<li><a target="_top" href="/developers_best_practices/index.htm">Developer's Best Practices</a></li>
<li><a target="_top" href="/questions_and_answers.htm">Questions and Answers</a></li>
<li><a target="_top" href="/effective_resume_writing.htm">Effective Resume Writing</a></li>
<li><a target="_top" href="/hr_interview_questions/index.htm">HR Interview Questions</a></li>
<li><a target="_top" href="/computer_glossary.htm">Computer Glossary</a></li>
<li><a target="_top" href="/computer_whoiswho.htm">Who is Who</a></li>
</ul>
</div>
<!-- Tutorial ToC Ends Here -->
<!-- Tutorial Content Starts Here -->
<div class="mui-col-md-6 tutorial-content">
<h1>Microsoft Dynamics CRM - Plugins</h1>
<hr />
<div class="top-ad-heading">Advertisements</div>
<div style="text-align: center;">
<script><!--
google_ad_client = "pub-7133395778201029";
var width = document.getElementsByClassName("tutorial-content")[0].clientWidth - 40;
google_ad_width = width;
google_ad_height = 150;
google_ad_format = width + "x150_as";
google_ad_type = "image";
google_ad_channel = "";
//--></script>
<script src="https://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</div>
<div class="mui-container-fluid button-borders">
<div class="pre-btn">
<a href="/microsoft_crm/microsoft_crm_workflow_processes.htm"><i class="fal fa-chevron-circle-left"></i> Previous Page</a>
</div>
<div class="nxt-btn">
<a href="/microsoft_crm/microsoft_crm_plugin_registration.htm">Next Page <i class="fal fa-chevron-circle-right"></i>&nbsp;</a>
</div>
</div>
<div class="clearer"></div>
<p>A plug-in is a custom business logic that integrates with Microsoft Dynamics CRM to modify or extend the standard behavior of the platform. Plug-ins act as event handlers and are registered to execute on a particular event in CRM. Plugins are written in either C# or VB and can run either in synchronous or asynchronous mode.</p>
<p>Some scenarios where you would write a plugin are &minus;</p>
<ul class="list">
<li><p>You want to execute some business logic such as updating certain fields of a record or updating related records, etc. when you create or update a CRM record.</p></li>
<li><p>You want to call an external web service on certain events such as saving or updating a record.</p></li>
<li><p>You want to dynamically calculate the field values when any record is opened.</p></li>
<li><p>You want to automate processes such as sending e-mails to your customers on certain events in CRM.</p></li>
</ul>
<h2>Event Framework</h2>
<p>The Event Processing Framework in CRM processes the synchronous and asynchronous plugin requests by passing it to the event execution pipeline. Whenever an event triggers a plugin logic, a message is sent to the CRM Organization Web Service where it can be read or modified by other plugins or any core operations of the platform.</p>
<h2>Plugin Pipeline Stages</h2>
<p>The entire plugin pipeline is divided in multiple stages on which you can register your custom business logic. The pipeline stage specified indicates at which stage of the plugin execution cycle, your plugin code runs. Out of all the specified pipeline stages in the following table, you can register your custom plugins only on Pre- and Post-events. You can’t register plugins on Platform Core Main Operations.</p>
<table class="table table-bordered">
<tr>
<th style="text-align:center;">Event</th>
<th style="text-align:center;">Stage Name</th>
<th style="text-align:center;">Description</th>
</tr>
<tr>
<td style="text-align:center;vertical-align:middle;">Pre-Event</td>
<td style="text-align:center;vertical-align:middle;">Pre-validation</td>
<td>Stage in the pipeline for plug-ins that are to execute before the main system operation. Plug-ins registered in this stage may execute outside the database transaction.</td>
</tr>
<tr>
<td style="text-align:center;vertical-align:middle;">Pre-Event</td>
<td style="text-align:center;vertical-align:middle;">Pre-operation</td>
<td>Stage in the pipeline for plug-ins that are to executed before the main system operation. Plugins registered in this stage are executed within the database transaction.</td>
</tr>
<tr>
<td style="text-align:center;vertical-align:middle;">Platform Core Operation</td>
<td style="text-align:center;vertical-align:middle;">MainOperation</td>
<td>Intransaction,the main operation of the system, such as create, update, delete, and so on. No custom plug-ins can be registered in this stage. For internal use only.</td>
</tr>
<tr>
<td style="text-align:center;vertical-align:middle;">Post-Event</td>
<td style="text-align:center;vertical-align:middle;">Post-operation</td>
<td>Stage in the pipeline for plug-ins which are to executed after the main operation. Plug-ins registered in this stage are executed within the database transaction.</td>
</tr>
</table>
<p>Whenever the CRM application invokes an event (like saving or updating a record), the following sequence of actions takes place &minus;</p>
<ul class="list">
<li><p>The event triggers a Web service call and the execution is passed through the event pipeline stages (pre-event, platform core operations, post-event).</p></li>
<li><p>The information is internally packaged as an OrganizationRequest message and finally sent to the internal CRM Web service methods and platform core operations.</p></li>
<li><p>The OrganizationRequest message is first received by pre-event plugins, which can modify the information before passing it to platform core operations. After the platform core operations, the message is packaged as OrganizationResponse and passed to the post-operation plugins. The postoperations plugins can optionally modify this information before passing it to the async plugin.</p></li>
<li><p>The plugins receive this information in the form of context object that is passed to the Execute method after which the further processing happens.</p></li>
<li><p>After all the plugin processing completes, the execution is passed back to the application which triggered the event.</p></li>
</ul>
<h2>Plugin Messages</h2>
<p>Messages are the events on which the plugin (or business logic) is registered. For example, you can register a plugin on Create Message of Contact entity. This would fire the business logic whenever a new Contact record is created.</p>
<p>For custom entities, following are the supported messages based on whether the entity is user-owned or organization-owned.</p>
<table class="table table-bordered">
<tr>
<th style="text-align:center;">Message Name</th>
<th style="text-align:center;">Ownership Type</th>
</tr>
<tr>
<td style="text-align:center;">Assign</td>
<td>User-owned entities only</td>
</tr>
<tr>
<td style="text-align:center;">Create</td>
<td>User-owned and organization-owned entities</td>
</tr>
<tr>
<td style="text-align:center;">Delete</td>
<td>User-owned and organization-owned entities</td>
</tr>
<tr>
<td style="text-align:center;">GrantAccess</td>
<td>User-owned entities only</td>
</tr>
<tr>
<td style="text-align:center;">ModifyAccess</td>
<td>User-owned entities only</td>
</tr>
<tr>
<td style="text-align:center;">Retrieve</td>
<td>User-owned and organization-owned entities</td>
</tr>
<tr>
<td style="text-align:center;">RetrieveMultiple</td>
<td>User-owned and organization-owned entities</td>
</tr>
<tr>
<td style="text-align:center;">RetrievePrincipalAccess</td>
<td>User-owned entities only</td>
</tr>
<tr>
<td style="text-align:center;">RetrieveSharedPrincipalsAndAccess</td>
<td>User-owned entities only</td>
</tr>
<tr>
<td style="text-align:center;">RevokeAccess</td>
<td>User-owned entities only</td>
</tr>
<tr>
<td style="text-align:center;">SetState</td>
<td>User-owned and organization-owned entities</td>
</tr>
<tr>
<td style="text-align:center;">SetStateDynamicEntity</td>
<td>User-owned and organization-owned entities</td>
</tr>
<tr>
<td style="text-align:center;">Update</td>
<td>User-owned and organization-owned entities</td>
</tr>
</table>
<p>For default out-of-the-box entities, there are more than 100 supported messages. Some of these messages are applicable for all the entities while some of them are specific to certain entities. You can find the complete list of supported message in an excel file inside the SDK: <b>SDK\Message-entity support for plug-ins.xlsx</b></p>
<h2>Writing Plugin</h2>
<p>In this section, we will learn the basics of writing a plugin. We will be creating a sample plugin that creates a Task activity to follow-up with the customer whenever a new customer is added to the system, i.e. whenever a new Contactrecord is created in CRM.</p>
<p>First of all, you would need to include the references to <b>Microsoft.Xrm.Sdk</b> namespace. The CRM SDK contains all the required SDK assemblies. Assuming that you have already downloaded and installed the SDK in Chapter 2, open Visual Studio. Create a new project of type Class Library. You can name the project as SamplePlugins and click OK.</p>
<img src="/microsoft_crm/images/mscrm_plugin_create_vs_solution.jpg" alt="Mscrm Plugin Create vs Solution" />
<p>Add the reference of <b>Microsoft.Xrm.Sdk</b> assembly to your project. The assembly is present in <b>SDK/Bin</b>.</p>
<img src="/microsoft_crm/images/mscrm_plugin_add_solution_reference.jpg" alt="Mscrm Plugin Add Solution Reference" />
<p>Now, create a class named <b>PostCreateContact.cs</b> and extend the class from <b>IPlugin</b>. Till now, your code will look something like the following.</p>
<img src="/microsoft_crm/images/mscrm_plugin_sample_code.jpg" alt="Mscrm Plugin Sample Code" />
<p>You will also need to add reference to System.Runtime.Serialization. Once you have added the required references, copy the following code inside the <b>PostCreateContact</b> class.</p>
<pre class="prettyprint notranslate">
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using Microsoft.Xrm.Sdk;

namespace SamplePlugins {
   public class PostCreateContact:IPlugin {
      /// A plug-in that creates a follow-up task activity when a new account is created.
      /// Register this plug-in on the Create message, account entity,
      /// and asynchronous mode.

      public void Execute(IServiceProviderserviceProvider) {
         // Obtain the execution context from the service provider.
         IPluginExecutionContext context =(IPluginExecutionContext)
            serviceProvider.GetService(typeof(IPluginExecutionContext));

         // The InputParameters collection contains all the data
            passed in the message request.

         if(context.InputParameters.Contains("Target")&&
            context.InputParameters["Target"]isEntity) {
            
            // Obtain the target entity from the input parameters.
            Entity entity = (Entity)context.InputParameters["Target"];
            try {
               
               // Create a task activity to follow up with the account customer in 7 days
               Entity followup = new Entity("task");
               followup["subject"] = "Send e-mail to the new customer.";
               followup["description"] =
                  "Follow up with the customer. Check if there are any new issues
                  that need resolution.";
               
               followup["scheduledstart"] = DateTime.Now;
               followup["scheduledend"] = DateTime.Now.AddDays(2);
               followup["category"] = context.PrimaryEntityName;

               // Refer to the contact in the task activity.
               if(context.OutputParameters.Contains("id")) {
                  Guid regardingobjectid = new Guid(context.OutputParameter
                     s["id"].ToString());
                  string regardingobjectidType = "contact";
                  followup["regardingobjectid"] = 
                     new EntityReference(rega rdingobjectidType,regardingobjectid);
               }
               
               // Obtain the organization service reference.
               IOrganizationServiceFactory serviceFactory =
                  (IOrganizationSer viceFactory)serviceProvider.GetService
                  (typeof(IOrganizationServiceFactory));
               IOrganizationService service = 
                  serviceFactory.CreateOrganizationService(context.UserId);

               // Create the followup activity
               service.Create(followup);
            } catch(Exception ex) {
               throw new InvalidPluginExecutionException(ex.Message);
            }
         }
      }
   }
}
</pre>
<p>Following is a step-by-step explanation of what this code does &minus;</p>
<p><b>Step 1</b> &minus; Implements the Execute method by taking IServiceProvider object as its parameter. The service provider contains references to many useful objects that you are going to use within plugin.</p>
<p><b>Step 2</b> &minus; Obtains the IPluginExecutionContext object using the GetService method of IServiceProvider.</p>
<p><b>Step 3</b> &minus; Gets the target entity’s object from the context object’s InputParameters collection. This Entity class object refers to the Contact entity record on which our plugin would be registered.</p>
<p><b>Step 4</b> &minus; It then creates an object of Task entity and sets proper subject, description, dates, category and regardingobjectid. The regardingobjectid indicates for which contact record this activity record is being created. You can see that the code gets the id of the parent Contact record using context.OutputParameters and associates it with the Task entity record which you have created.</p>
<p><b>Step 5</b> &minus; Creates object of IOrganizationServiceFactory using the IServiceProvider object.</p>
<p><b>Step 6</b> &minus; Creates object of IOrganizationService using the IOrganizationServiceFactory object.</p>
<p><b>Step 7</b> &minus; Finally, using the Create method of this service object. It creates the follow-up activity which gets saved in CRM.</p>
<h2>Signing the Plugin Assembly</h2>
<p>This section is applicable only if you are registering your plugin assembly for the first time. You need to sign in the assembly with a key to be able to deploy the plugin. Rightclick the solution and click Properties.</p>
<img src="/microsoft_crm/images/mscrm_plugin_solution_properties.jpg" alt="Mscrm Plugin Solution Properties" />
<p>Select the Signing tab from the left options and check the ‘Sign the assembly’ option. Then, select New from Choose a strong name key file option.</p>
<img src="/microsoft_crm/images/mscrm_plugin_sign_assembly.jpg" alt="Mscrm Plugin Sign Assembly" />
<p>Enter the Key file name as sampleplugins (This can be any other name you want). Uncheck the Protect my key file with a password option and click OK. Click Save.</p>
<img src="/microsoft_crm/images/mscrm_plugin_sign_assembly_add_key.jpg" alt="Mscrm Plugin Sign Assembly Add Key" />
<p>Finally, build the solution. Right Click &rarr; Build. Building the solution will generate assembly DLL, which we will use in the next chapter to register this plugin.</p>
<h2>Exception Handling in Plugin</h2>
<p>More often than not, your plugin logic will need to handle run-time exceptions. For synchronous plugins, you can return an <b>InvalidPluginExecutionException</b> exception, which will show an error dialog box to the user. The error dialog will contain the custom error message that you pass to the Message object of the exception object.</p>
<p>If you look at our code, we are throwing the InvalidPluginExecutionException exception in our catch block.</p>
<pre class="result notranslate">
throw new InvalidPluginExecutionException(ex.Message); 
</pre>
<h3>Conclusion</h3>
<p>Plugins are definitely crucial to any custom CRM implementation. In this chapter, we focused on understanding the event framework model, pipeline stages, messages, and writing a sample plugin. In the next chapter, we will register this plugin in CRM and see it working from end-to-end scenario.</p>
<div class="mui-container-fluid button-borders show">
<div class="pre-btn">
<a href="/microsoft_crm/microsoft_crm_workflow_processes.htm"><i class="fal fa-chevron-circle-left"></i> Previous Page</a>
</div>
<div class="nxt-btn">
<a href="/microsoft_crm/microsoft_crm_plugin_registration.htm">Next Page <i class="fal fa-chevron-circle-right"></i>&nbsp;</a>
</div>
</div>
<div class="google-bottom-ads">
<div>Advertisements</div>
<script><!--
var width = 580;
var height = 400;
var format = "580x400_as";
if( window.innerWidth < 468 ){
   width = 300;
   height = 250;
   format = "300x250_as";
}
google_ad_client = "pub-7133395778201029";
google_ad_width = width;
google_ad_height = height;
google_ad_format = format;
google_ad_type = "image";
google_ad_channel ="";
//--></script>
<script src="https://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
<div class="space-bottom"></div>
</div>
</div>
<!-- Tutorial Content Ends Here -->
<!-- Right Column Starts Here -->
<div class="mui-col-md-2 google-right-ads">
<div class="space-top"></div>
<div class="google-right-ad" style="margin: 0px auto !important;margin-top:5px;">
<script><!--
google_ad_client = "pub-2537027957187252";
google_ad_width = 300;
google_ad_height = 250;
google_ad_format = "300x250_as";
google_ad_type = "image";
google_ad_channel ="";
//--></script>
<script src="https://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</div>
<div class="google-right-ad">
<div class="adsbyvli" data-ad-slot="vi_9012177"></div>
<script>(vitag.Init = window.vitag.Init || []).push(function(){viAPItag.display("vi_9012177")})</script>
</div>
<div class="space-bottom"></div>
<div class="google-right-ad">
<div class="adsbyvli" data-ad-slot="vi_9013289"></div>
<script>(vitag.Init = window.vitag.Init || []).push(function(){viAPItag.display("vi_9013289")})</script>
</div>
<div class="space-bottom" style="margin-bottom:15px;"></div>
</div>
<!-- Right Column Ends Here -->
</div>
</div>
<div class="clear"></div>
<footer id="footer">
<div class="mui--text-center">
<div class="mui--text-caption mui--text-light">
<a href="/index.htm" class="logo"><img class="img-responsive" src="/images/logo-black.png" alt="Tutorials Point" title="Tutorials Point"></a>
</div>
<ul class="mui-list--inline mui--text-body2 mui--text-light">
<li><a href="/about/index.htm"><i class="fal fa-globe"></i> About us</a></li>
<li><a href="/about/about_terms_of_use.htm"><i class="fal fa-asterisk"></i> Terms of use</a></li>
<li><a href="/about/about_privacy.htm#cookies"> <i class="fal fa-shield-check"></i> Cookies Policy</a></li>
<li><a href="/about/faq.htm"><i class="fal fa-question-circle"></i> FAQ's</a></li>
<li><a href="/about/about_helping.htm"><i class="fal fa-hands-helping"></i> Helping</a></li>
<li><a href="/about/contact_us.htm"><i class="fal fa-map-marker-alt"></i> Contact</a></li>
</ul>
<div class="mui--text-caption mui--text-light bottom-copyright-text">&copy; Copyright 2019. All Rights Reserved.</div>
</div>
<div id="privacy-banner">
  <div>
    <p>
      We use cookies to provide and improve our services. By using our site, you consent to our Cookies Policy.
      <a id="banner-accept" href="#">Accept</a>
      <a id="banner-learn" href="/about/about_cookies.htm" target="_blank">Learn more</a>
    </p>
  </div>
</div>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-232293-17"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-232293-6');
</script>
</footer>
</body>
</html>
